# 21.1 MySQL AdminAPI
>This section provides an overview of AdminAPI and what you need to know to get started.

本节提供AdminAPI的概述以及开始时需要了解的内容。

>MySQL Shell includes the AdminAPI, which is accessed through the dba global variable and its associated methods. The dba variable's methods provide operations which enable you to deploy, configure, and administer InnoDB Cluster and InnoDB ReplicaSet. For example, use the dba.createCluster() method to create an InnoDB Cluster. In addition, AdminAPI supports administration of some MySQL Router related tasks, such as creating and updating users that enable you to integrate your InnoDB Cluster and InnoDB ReplicaSet.

MySQL Shell包含AdminAPI，通过它可以访问dba的全局参数和与它相关的方法。dba全局参数方法提供一些操作，可以让您部署、配置和管理InnoDB Cluster和Innodb ReplicaSet。例如，使用`dba.createCluster`方法来创建InnoDB Cluster。此外，AdminAPI支持管理一些MySQL Router相关任务，例如创建和更新用户，使您可以集成您的InnoDB Cluster和InnoDB ReplicaSet。

>MySQL Shell provides two scripting language modes, JavaScript and Python, in addition to a native SQL mode. Throughout this guide MySQL Shell is used primarily in JavaScript mode. When MySQL Shell starts it is in JavaScript mode by default. Switch modes by issuing \js for JavaScript mode, and \py for Python mode. Ensure you are in JavaScript mode by issuing the \js.

除了原生的SQL模式，MySQL Shell还提供了两种脚本语言模式，JavaScript和Python。在本指南中，MySQL Shell主要是使用JavaScript模式。MySQL Shell启动时，默认是JavaScript模式。通过输入`\js`切换到JavaScript模式，`\py`切换到Python模式。通过输入`\js`确保您在JavaScript模式下。

>**Important**

>MySQL Shell enables you to connect to servers over a socket connection, but AdminAPI requires TCP connections to a server instance. Socket based connections are not supported in AdminAPI.

MySQL Shell允许您通过套接字链接访问server，但是AdminAPI需要TCP链接server实例。基于套接字的链接不支持AdminAPI。

>This section assumes familiarity with MySQL Shell, see MySQL Shell 8.0 (part of MySQL 8.0) for further information. MySQL Shell also provides online help for the AdminAPI. To list all available dba commands, use the dba.help() method. For online help on a specific method, use the general format object.help('methodname'). For example:

本章节假定您了解MySQL Shell，参阅[MySQL Shell8.0(MySQL8.0的一部分)](https://dev.mysql.com/doc/mysql-shell/8.0/en/)获取更多详细内容。MySQL Shell也对AdminAPI提供了在线帮助。如列出所有可用的dba命令，使用`dba.help()`。列出指定方法的在线帮助，可以使用通用格式`object.help('methodname')`。例如：

```
mysql-js> dba.help('getCluster')

Retrieves a cluster from the Metadata Store.

SYNTAX

  dba.getCluster([name][, options])

WHERE

  name: Parameter to specify the name of the cluster to be returned.
  options: Dictionary with additional options.

>trimmed for brevity<
```

>In addition to this documentation, there is developer documentation for all AdminAPI methods in the MySQL Shell JavaScript API Reference or MySQL Shell Python API Reference, available from Connectors and APIs.

除了这个文档之外，MySQL Shell JavaScript API参考指南或者MySQL Shell Python API参考指南中还有所有AdminAPI方法的开发文档，可以从[Connectors and APIs](https://dev.mysql.com/doc/index-connectors.html)获得。

>This section applies to using InnoDB Cluster or InnoDB ReplicaSet and consists of:

本节适用于InnoDB Cluster或者InnoDB ReplicaSet，包括：

[部署场景](#部署场景)

[安装组件](#安装组件)

[配置Hostname](#配置Hostname)

## 部署场景
>AdminAPI supports the following deployment scenarios:

AdminAPI支持以下部署场景：

>- **Production deployment**: if you want to use a full production environment you need to configure the required number of machines and then deploy your server instances to the machines.

- **生产环境部署**：如果您想使用一个完整的生产环境，您需要配置所需数量的机器，部署您的server实例在这些机器上。

> - **Sandbox deployment**: if you want to test a deployment before committing to a full production deployment, the provided sandbox feature enables you to quickly set up a test environment on your local machine. Sandbox server instances are created with the required configuration and you can experiment to become familiar with the technologies employed.

- **沙箱环境部署**：如果您是想在完成完整生产环境部署前测试部署，提供的沙箱功能可以让您快速在本机上建立测试环境。沙箱服务实例根据所需配置建立，您可以通过实验熟悉使用的技术。

## 安装组件
>How you install the software components required by AdminAPI depends on the type of deployment you intend to use. For a production deployment, install the components to each machine. A production deployment uses multiple remote host machines running MySQL server instances, so you need to connect to each machine using a tool such as SSH or Windows remote desktop to carry out tasks such as installing components. For a sandbox deployment, install the components to a single machine. A sandbox deployment is local to a single machine, therefore the install needs to only be done once on the local machine. The following methods of installing are available:
>
>Downloading and installing the components using the following documentation:
>
>- MySQL Server - see Chapter 2, Installing and Upgrading MySQL.
>
>- MySQL Shell - see Installing MySQL Shell.
>
>- MySQL Router - see Installing MySQL Router.
>
>Always use the matching version of components, for example run MySQL Shell 8.0.23 to administer instances running MySQL 8.0.23 with MySQL Router 8.0.23.
>
>Once you have installed the software required, choose to follow either Section 21.2, “MySQL InnoDB Cluster” or Section 21.3, “MySQL InnoDB ReplicaSet”.

如何安装AdminAPI所需的软件组件取决于您打算使用的部署类型。对于生产环境部署，在每台机器上安装组件。生产环境部署使用多个远程主机运行MySQL server实例，所以您需要使用SSH等工具或者Windows远程桌面
连接每台机器执行例如安装组件的任务。对于沙箱环境部署，安装组件在一个单独的机器。沙箱环境部署在本地的单个机器上，因此只需要在本地机器上安装一次。下面是可用的安装方法：

下载和使用以下文档安装组件：

- MySQL Server - 参阅[章节2，安装和升级MySQL](https://dev.mysql.com/doc/refman/8.0/en/installing.html)

- MySQL Shell - 参阅[安装MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-install.html)

- MySQL Router - 参阅[安装MySQL Router](https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-installation.html)

始终使用同一版本组件，例如使用MySQL Shell8.0.23版管理MySQL 8.0.23和MySQL Router 8.0.23。

当完成安装所需软件，可以选择[章节21.2，MySQL InnoDB Cluster](https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-cluster.html)或者[章节21.3，MySQL InnoDB ReplicaSet](https://dev.mysql.com/doc/refman/8.0/en/mysql-innodb-replicaset.html)。

## 配置Hostname
>In a production deployment, the instances which you use run on separate machines, therefore each machine must have a unique host name and be able to resolve the host names of the other machines which run server instances. If this is not the case, you can:
>
>- configure each machine to map the IP of each other machine to a host name. See your operating system documentation for details. This is the recommended solution.
>
>- set up a DNS service
>
>- configure the report_host variable in the MySQL configuration of each instance to a suitable externally reachable address
>
>AdminAPI supports using IP addresses instead of host names. From MySQL Shell 8.0.18, AdminAPI supports IPv6 addresses if the target MySQL Server version is higher than 8.0.13. When using MySQL Shell 8.0.18 or higher, if all cluster instances are running 8.0.14 or higher then you can use an IPv6 or hostname that resolves to an IPv6 address for instance connection strings and with options such as localAddress, groupSeeds and ipWhitelist. For more information on using IPv6 see Section 18.4.5, “Support For IPv6 And For Mixed IPv6 And IPv4 Groups”. Previous versions support IPv4 addresses only.
>
>To verify whether the hostname of a MySQL server is correctly configured, execute the following query to see how the instance reports its own address to other servers and try to connect to that MySQL server from other hosts using the returned address:
>
>SELECT coalesce(@@report_host, @@hostname);

在生产环境部署中，您使用的实例运行在不同的机器上，因此每台机器必须有唯一主机名，并可以解析其他运行服务实例的机器主机名。如果不是这样，您可以：

- 配置每台机器，将其他机器的IP映射为主机名。查看您的系统文档获得更多信息。这是推荐解决方案。

- 设置DNS服务。

- 在每个实例的MySQL配置中，为`report_host`参数配置为合适的外部可访问的地址。

AdminAPI支持使用IP地址替代主机名。如果目标MySQL Server版本高于8.0.13，从MySQL Shell8.0.18开始，AdminAPI支持IPv6地址。当使用MySQL Shell 8.0.18及更高版本时，如果所有集群实例使用8.0.14及更高版本时，您可以使用IPv6或者可以解析成IPv6地址的主机名作为实例连接字符串，并可以添加`localAddress`、`groupSeeds`和`ipWhitelist`等选项。更多使用IPv6的信息可以参阅[章节18.4.5，支持IPv6和支持IPv6&IPv4混合](https://dev.mysql.com/doc/refman/8.0/en/group-replication-ipv6.html)。先前版本仅支持IPv4地址。

为检验MySQL server的主机名是否正确配置，执行以下查询查看实例上报的到其他server端的自身地址，并使用返回地址尝试从其他主机连接MySQL server。

```
SELECT coalesce(@@report_host, @@hostname);
```
